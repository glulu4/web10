{"version":3,"file":"wapi.modern.js","sources":["../../src/wapiAuth.js","../../src/wapi.js"],"sourcesContent":["import axios from 'axios';\r\n\r\n//initializes the sdk for web10 authenticators.\r\nconst wapiAuthInit = function(wapi) {\r\n  const wapiAuth = {};\r\n\r\n  //mints a second level token for the referrer site.\r\n  wapiAuth.mintOAuthToken = function () {\r\n    const referrerURL = new URL(document.referrer);\r\n    wapi\r\n      .getTieredToken(referrerURL.hostname, wapi.readToken().provider)\r\n      .then(function (response) {\r\n        wapiAuth.oAuthToken = response.data.token;\r\n      })\r\n  };\r\n\r\n  //initialize the oauth token\r\n  wapi.isSignedIn() && document.referrer ? wapiAuth.mintOAuthToken() : (wapiAuth.oAuthToken = null);\r\n\r\n  //send the apikey back to the oauth requesting site\r\n  wapiAuth.sendToken = function () {\r\n    window.opener.postMessage(\r\n      {\r\n        type: \"auth\",\r\n        token: wapiAuth.oAuthToken,\r\n      },\r\n      \"*\"\r\n    );\r\n    window.close();\r\n  };\r\n\r\n  //log into an existing web10 account\r\n  //get tokens for web10 auth, and a parent oauth application.\r\n  wapiAuth.logIn = function (provider, username, password) {\r\n    //web10 auth login\r\n    return axios\r\n      .post(`${wapi.defaultAPIProtocol}//${provider}/web10token`, {\r\n        username: username,\r\n        password: password,\r\n        token: null,\r\n        site: window.location.hostname,\r\n        target: null,\r\n      })\r\n      .then(function (response) {\r\n        wapi.setToken(response.data.token);\r\n        wapiAuth.mintOAuthToken();\r\n      })\r\n  };\r\n\r\n  //sign up for a new web10 account\r\n  wapiAuth.signUp = function (provider, username, password, betacode, phone) {\r\n    return axios\r\n      .post(`${wapi.defaultAPIProtocol}//${provider}/signup`, {\r\n        username: username,\r\n        password: password,\r\n        betacode:betacode,\r\n        phone: phone,\r\n      })\r\n  };\r\n\r\n  //If there is a referrer, listen for the SMR and use it to set a web10 auth app state\r\n  wapiAuth.SMRListen = function (setState) {\r\n    if (window.opener) {\r\n      window.addEventListener(\"message\", function (e) {\r\n        if (e.data.type === \"smr\") setState(e.data);\r\n      });\r\n      //Notify SMR requester that the auth app is ready.\r\n      window.opener.postMessage(\r\n        {\r\n          type: \"SMRListen\",\r\n        },\r\n        \"*\"\r\n      );\r\n    }\r\n  };\r\n\r\n  const api = ()=> `${wapi.defaultAPIProtocol}//${wapi.readToken()[\"provider\"]}`;\r\n\r\n\r\n  //change functionality\r\n  wapiAuth.changePass = function(pass,newPass){\r\n    return axios.post(`${api()}/change_pass`,{username:wapi.readToken()[\"username\"],password:pass,new_pass:newPass})\r\n  }\r\n\r\n  wapiAuth.changePhone= function(pass,newPhone){\r\n    console.log(\"in : \",pass,newPhone)\r\n    return axios.post(`${api()}/change_phone`,{username:wapi.readToken()[\"username\"],password:pass,phone:newPhone})\r\n  }\r\n\r\n\r\n  //twilio functionality\r\n  wapiAuth.sendCode = function(){\r\n    return axios.post(`${api()}/send_code`,{token:wapi.token})\r\n  }\r\n  wapiAuth.verifyCode = function(code){\r\n    return axios.post(`${api()}/verify_code`,{token:wapi.token,query:{code:code}})\r\n  }\r\n\r\n  //stripe functionality\r\n  wapiAuth.manageSpace = function(){\r\n    return axios.post(`${api()}/manage_space`,{token:wapi.token})\r\n  }\r\n  wapiAuth.manageCredits = function(){\r\n    return axios.post(`${api()}/manage_credits`,{token:wapi.token})\r\n  }\r\n  wapiAuth.manageBusiness = function(){\r\n    return axios.post(`${api()}/manage_business`,{token:wapi.token})\r\n  }\r\n\r\n  wapiAuth.manageSubscriptions = function(){\r\n    return axios.post(`${api()}/manage_subscriptions`,{token:wapi.token})\r\n  }\r\n\r\n  wapiAuth.businessLogin = function(){\r\n    return axios.post(`${api()}/business_login`,{token:wapi.token})\r\n  }\r\n\r\n  wapiAuth.getPlan = function(){\r\n    return axios.post(`${api()}/get_plan`,{token:wapi.token})\r\n  }\r\n\r\n  //output the wapiAuth object\r\n  return wapiAuth;\r\n}\r\n\r\nexport {wapiAuthInit};","import axios from 'axios'\r\nimport { Peer } from \"peerjs\";\r\nimport {wapiAuthInit} from './wapiAuth'\r\n\r\n//helper function for loading relevant cookies on page load.\r\nfunction cookieDict() {\r\n  return window.document.cookie.split(\";\").reduce((res, c) => {\r\n    const [key, val] = c.trim().split(\"=\").map(decodeURIComponent);\r\n    try {\r\n      return Object.assign(res, { [key]: JSON.parse(val) });\r\n    } catch (e) {\r\n      return Object.assign(res, { [key]: val });\r\n    }\r\n  }, {});\r\n}\r\n\r\n//initializes the sdk for web10 apps.\r\nconst wapiInit = function(authUrl = \"https://auth.web10.app\", appStores=[\"https://api.web10.app\"], rtcServer = \"rtc.web10.app\") {\r\n  const wapi = {};\r\n\r\n  // get the default api protocol, which is required to match its auth portals protocol\r\n  wapi.APIProtocol = new URL(authUrl).protocol;\r\n\r\n  //wapi variables\r\n  wapi.childWindow = null;\r\n  wapi.token = cookieDict()[\"token\"];\r\n\r\n  /************ \r\n   *** AUTH ***\r\n   ************/\r\n\r\n  //sets the api key in wapi and stores it in cookies\r\n  wapi.setToken = function (token) {\r\n    wapi.token = token;\r\n    //set the cookie max age to 60 days (1 day padding from the true 61 day expiration)\r\n    const age = 3600 * 24 * 60;\r\n    document.cookie = `token=${wapi.token};Secure;path=/;max-age=${age};`;\r\n  };\r\n\r\n  //scrub the api keys from wapi and deletes it from cookies\r\n  wapi.scrubToken = function () {\r\n    document.cookie = \"token=;max-age=-1;path=/;\";\r\n    wapi.token = null;\r\n  };\r\n\r\n  //opens up a child window for auth stuff\r\n  wapi.openAuthPortal = () => wapi.childWindow = window.open(authUrl, \"_blank\");\r\n\r\n  //checks if wapi is currently signed in\r\n  wapi.isSignedIn = () => wapi.token != null;\r\n\r\n  //signs out wapi\r\n  wapi.signOut = () => wapi.scrubToken();\r\n\r\n  //listens for an oauth result from the child window\r\n  wapi.authListen = setAuth => window.addEventListener(\"message\", e => {\r\n    if (e.data.type === \"auth\") {\r\n      wapi.setToken(e.data.token || \"\");\r\n      if (setAuth != null) setAuth(wapi.isSignedIn());\r\n    }\r\n  });\r\n\r\n  wapi.readToken = () => !wapi.token ? null : JSON.parse(atob(wapi.token.split(\".\")[1]));\r\n\r\n  //get tiered tokens for strong web10 security\r\n  wapi.getTieredToken = (site, target, protocol = wapi.APIProtocol) => axios\r\n    .post(`${protocol}//${wapi.readToken().provider}/web10token`, {\r\n      username: wapi.readToken().username,\r\n      password: null,\r\n      token: wapi.token,\r\n      site,\r\n      target\r\n    });\r\n\r\n  /**************\r\n   **** CRUD ****\r\n   **************/\r\n\r\n  //patch instead of get so patch can have an HTTPS E2E encrypted body\r\n  wapi.read = (service, query = null, username = null, provider = null, protocol = wapi.APIProtocol) => wapi\r\n  ._W10CRUD(axios.patch, provider, username, service, query, null, protocol);\r\n  wapi.read = (service, query = null, username = null, provider = null, protocol = wapi.APIProtocol) => wapi\r\n    ._W10CRUD(axios.patch, provider, username, service, query, null, protocol);\r\n  wapi.create = (service, query = null, username = null, provider = null, protocol = wapi.APIProtocol) => wapi\r\n    ._W10CRUD(axios.post, provider, username, service, query, null, protocol);\r\n  wapi.update = (service, query = null, update = null, username = null, provider = null, protocol = wapi.APIProtocol) => wapi\r\n    ._W10CRUD(axios.put, provider, username, service, query, update, protocol);\r\n  //axios delete is implemented differently\r\n  wapi.delete = (service, query = null, username = null, provider = null, protocol = wapi.APIProtocol) => wapi\r\n    ._W10CRUD((url, data) => axios.delete(url, { data: data }), provider, username, service, query, null, protocol);\r\n\r\n  wapi._W10CRUD = function (HTTPRequestFunction, provider, username, service, query, update, protocol) {\r\n    if ((!username && !wapi.token) || username === \"anon\") return console.error(\"cant CRUD anon accounts\");\r\n    if (!provider && !wapi.token) return console.error(\"web10 request without provider and token. need one.\");\r\n\r\n    provider = provider || wapi.readToken().provider;\r\n    username = username || wapi.readToken().username;\r\n    return HTTPRequestFunction(`${protocol}//${provider}/${username}/${service}`, { token: wapi.token, query, update });\r\n  };\r\n\r\n  //SMRs\r\n  wapi.SMROnReady = (sirs, scrs) => window\r\n    .addEventListener(\"message\", e => e.data[\"type\"] === \"SMRListen\" && wapi.childWindow.postMessage({ type: \"smr\", sirs, scrs }, \"*\"));\r\n  wapi.SMRResponseListen = setStatus => window\r\n    .addEventListener(\"message\", e => e.data.type === \"status\" && setStatus(e.data.status));\r\n\r\n  /*************\r\n   **** P2P ****\r\n   *************/\r\n\r\n  wapi.peer = null;\r\n\r\n  wapi.peerID = (provider, user, origin, label) => `${provider} ${user} ${origin} ${label}`.replaceAll(\".\", \"_\");\r\n\r\n  // initializes the peer and listens for inbound connections\r\n  wapi.inBound = {}\r\n  wapi.initP2P = function (onInbound = null, label = \"\", secure = true) {\r\n    const token = wapi.readToken();\r\n    var id = wapi.peerID(token.provider, token.username, token.site, label);\r\n    wapi.peer = new Peer(id, {\r\n      host: rtcServer,\r\n      secure: secure,\r\n      port: secure ? 443 : 80,\r\n      path: '/',\r\n      token: `${wapi.token}~${label}`,\r\n    });\r\n\r\n    if (onInbound) {\r\n      wapi.peer.on('connection', function (conn) {\r\n        wapi.inBound[conn.peer] = conn;\r\n        conn.on('data', (data) => onInbound(conn, data));\r\n        conn.on('close', () => delete wapi.inBound[conn.peer])\r\n      });\r\n    }\r\n  }\r\n\r\n  // makes outbound connection IF it doesnt already exist\r\n  // else returns the existing connection\r\n  wapi.outBound = {}\r\n\r\n  wapi.P2P = function (provider, username, origin, label) {\r\n    if (!wapi.peer) console.error(\"not initialized\")\r\n    const id = wapi.peerID(provider, username, origin, label)\r\n    var conn = null;\r\n    if (!wapi.outBound[id]) {\r\n      conn = wapi.peer.connect(id);\r\n      wapi.outBound[conn.peer] = conn;\r\n      conn.on('close', () => delete wapi.outBound[conn.peer])\r\n    } else conn = wapi.outBound[id]\r\n    return conn\r\n  }\r\n\r\n  wapi.send = function (provider, username, origin, label, data) {\r\n    const conn = wapi.P2P(provider, username, origin, label);\r\n    if (conn.open) {\r\n      conn.send(data);\r\n      return { connected: true };\r\n    }\r\n    else {\r\n      conn.on('open', () => conn.send(data))\r\n      return { connected: false };\r\n    }\r\n  }\r\n\r\n\r\n  /*************** \r\n   *** dev pay ***\r\n   ***************/\r\n\r\n  wapi.checkout = (seller, title, price, success_url, cancel_url) => axios\r\n    .post(`${wapi.APIProtocol}//${wapi.readToken().provider}/dev_pay`, {\r\n      token: wapi.token,\r\n      seller: seller,\r\n      title,\r\n      price,\r\n      success_url,\r\n      cancel_url\r\n    }).then(response => window.location.href = response.data);\r\n\r\n  wapi.verifySubscription = (seller, title) => axios\r\n    .patch(`${wapi.APIProtocol}//${wapi.readToken().provider}/dev_pay`, {\r\n      token: wapi.token,\r\n      seller,\r\n      title,\r\n      price: null,\r\n    });\r\n\r\n  wapi.cancelSubscription = (seller, title) => axios\r\n    .delete(`${wapi.APIProtocol}//${wapi.readToken().provider}/dev_pay`, {\r\n      data: { token: wapi.token, seller, title, }\r\n    });\r\n\r\n  //register with the appStores\r\n  console.log(appStores)\r\n  for (const [i, appStore] of appStores.entries()) {\r\n    axios.post(appStore+\"/register_app\", { \"url\": window.location.href.split('?')[0] })\r\n  }\r\n\r\n  //output the wapi object\r\n  return wapi;\r\n}\r\n\r\n//browserify window access\r\nwindow.wapiInit = wapiInit;\r\nwindow.wapiAuthInit = wapiAuthInit;\r\nexport {wapiInit,wapiAuthInit};"],"names":["wapiAuthInit","wapi","wapiAuth","mintOAuthToken","referrerURL","URL","document","referrer","getTieredToken","hostname","readToken","provider","then","response","oAuthToken","data","token","isSignedIn","sendToken","window","opener","postMessage","type","close","logIn","username","password","axios","post","defaultAPIProtocol","site","location","target","setToken","signUp","betacode","phone","SMRListen","setState","addEventListener","e","api","changePass","pass","newPass","new_pass","changePhone","newPhone","console","log","sendCode","verifyCode","code","query","manageSpace","manageCredits","manageBusiness","manageSubscriptions","businessLogin","getPlan","cookieDict","cookie","split","reduce","res","c","trim","map","decodeURIComponent","key","val","Object","assign","JSON","parse","wapiInit","authUrl","appStores","rtcServer","APIProtocol","protocol","childWindow","age","scrubToken","openAuthPortal","open","signOut","authListen","setAuth","atob","read","service","_W10CRUD","patch","create","update","put","url","HTTPRequestFunction","error","SMROnReady","sirs","scrs","SMRResponseListen","setStatus","status","peer","peerID","user","origin","label","replaceAll","inBound","initP2P","onInbound","secure","id","Peer","host","port","path","on","conn","outBound","P2P","connect","send","connected","checkout","seller","title","price","success_url","cancel_url","href","verifySubscription","cancelSubscription","entries","i","appStore"],"mappings":"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"}